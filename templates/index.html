<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RankPO - AI Recruitment</title>
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>
    <div class="container">
        <h1>🎯 RankPO - AI Recruitment</h1>
        <p>Автоматизация рекрутинга для e-commerce компаний</p>
        
        <div class="upload-section">
            <h2>📄 Загрузить резюме</h2>
            <form id="uploadForm" enctype="multipart/form-data">
                <input type="file" id="fileInput" accept=".pdf,.docx,.doc,.txt" required>
                <button type="submit">Загрузить</button>
            </form>
            <div id="message"></div>
        </div>
        
        <div class="candidates-section">
            <h2>👥 Список кандидатов</h2>
            <button onclick="loadCandidates()" class="load-btn">Загрузить список</button>
            <div id="candidatesList"></div>
        </div>
    </div>
    
    <script>
        document.getElementById('uploadForm').onsubmit = async (e) => {
            e.preventDefault();
            const formData = new FormData();
            formData.append('file', document.getElementById('fileInput').files[0]);
            
            try {
                const res = await fetch('/api/upload', {method: 'POST', body: formData});
                const data = await res.json();
                
                if (data.success) {
                    document.getElementById('message').innerText = 
                        '✅ Кандидат добавлен! ID: ' + data.candidate_id;
                    document.getElementById('message').style.background = '#d4edda';
                    document.getElementById('message').style.color = '#155724';
                    
                    setTimeout(() => {
                        document.getElementById('fileInput').value = '';
                        loadCandidates();
                    }, 1000);
                } else {
                    document.getElementById('message').innerText = '❌ Ошибка: ' + data.error;
                    document.getElementById('message').style.background = '#f8d7da';
                    document.getElementById('message').style.color = '#721c24';
                }
            } catch(e) {
                document.getElementById('message').innerText = '❌ Ошибка: ' + e;
                document.getElementById('message').style.background = '#f8d7da';
                document.getElementById('message').style.color = '#721c24';
            }
        };
        
        async function loadCandidates() {
            try {
                const res = await fetch('/api/candidates');
                const data = await res.json();
                
                if (data.candidates && data.candidates.length > 0) {
                    let html = '<table>';
                    html += '<tr><th>Имя</th><th>Позиция</th><th>Скор</th><th>Email</th><th>Дата</th></tr>';
                    
                    data.candidates.forEach(c => {
                        const score = (c.score || 0).toFixed(1);
                        const date = new Date(c.date_added).toLocaleDateString('ru-RU');
                        html += '<tr><td>' + c.name + '</td><td>' + (c.position || '-') + '</td><td class="score">' + score + '/100</td><td>' + (c.email || '-') + '</td><td>' + date + '</td></tr>';
                    });
                    html += '</table>';
                    document.getElementById('candidatesList').innerHTML = html;
                } else {
                    document.getElementById('candidatesList').innerHTML = '<p style="color: #999;">Кандидатов пока нет</p>';
                }
            } catch(e) {
                document.getElementById('candidatesList').innerText = '❌ Ошибка загрузки: ' + e;
            }
        }
        
        loadCandidates();
    </script>
</body>
</html>
